---
import { getCollection } from 'astro:content';
import PageLayout from '../layouts/PageLayout.astro';
import FormattedDate from '../components/FormattedDate.astro';
import { CONTACT_EMAIL } from '../consts';

const allPosts = await getCollection('news');
const posts = allPosts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<PageLayout
	title="News & Updates"
	subtitle="Milestones, Announcements, and Program Updates"
	description="Follow Future Voters Academy's progress â€” announcements, milestones, upcoming workshops, and organizational updates from FVA."
>
	<section>
		<h2>Latest Updates</h2>
		{posts.length === 0 ? (
			<p>No updates have been posted yet. Check back soon or follow us on Instagram for the latest news.</p>
		) : (
			<ul class="news-list">
				{posts.map((post) => (
					<li class="news-item">
						<div class="news-meta">
							<span class="news-category">{post.data.category}</span>
							<span class="news-date"><FormattedDate date={post.data.pubDate} /></span>
						</div>
						<a href={`/news/${post.id.replace(/\.(md|mdx)$/, '')}/`} class="news-title">{post.data.title}</a>
						<p class="news-desc">{post.data.description}</p>
						<a href={`/news/${post.id.replace(/\.(md|mdx)$/, '')}/`} class="news-read-more">Read full update &rarr;</a>
					</li>
				))}
			</ul>
		)}
	</section>

	<section>
		<h2>Stay Informed</h2>
		<p>
			To be notified of future updates, workshops, and milestones, email us at{' '}
			<a href={`mailto:${CONTACT_EMAIL}?subject=Stay Connected`}>{CONTACT_EMAIL}</a>{' '}
			with the subject line <strong>Stay Connected</strong>. You can also follow FVA on
			Instagram at{' '}
			<a href="https://www.instagram.com/futurevotersacademy" target="_blank" rel="noopener noreferrer">@futurevotersacademy</a>.
		</p>
	</section>
</PageLayout>

<style>
	.news-list {
		list-style: none;
		padding: 0;
		margin: 0;
	}
	.news-item {
		padding: 1.5rem 0;
		border-bottom: 1px solid rgb(var(--gray-light));
	}
	.news-item:last-child {
		border-bottom: none;
	}
	.news-meta {
		display: flex;
		align-items: center;
		gap: 0.75rem;
		margin-bottom: 0.4rem;
	}
	.news-category {
		font-size: 0.7rem;
		font-weight: 700;
		letter-spacing: 0.08em;
		text-transform: uppercase;
		background: rgb(var(--black));
		color: #ffffff;
		padding: 0.15rem 0.5rem;
	}
	.news-date {
		font-size: 0.8rem;
		color: rgb(var(--gray));
	}
	.news-title {
		display: block;
		font-size: 1.1rem;
		font-weight: 700;
		color: rgb(var(--black));
		text-decoration: none;
		margin-bottom: 0.4rem;
		line-height: 1.4;
	}
	.news-title:hover {
		color: var(--accent-warm);
	}
	.news-desc {
		font-size: 0.9rem;
		line-height: 1.7;
		color: rgb(var(--gray-dark));
		margin: 0 0 0.6rem;
	}
	.news-read-more {
		font-size: 0.85rem;
		font-weight: 600;
		color: var(--accent);
		text-decoration: underline;
		text-underline-offset: 2px;
	}
	.news-read-more:hover {
		color: var(--accent-warm);
	}
</style>
